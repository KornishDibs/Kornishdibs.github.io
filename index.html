<!doctype html>
<html lang=”en-gb”>
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Name of your awesome camera app -->
<title>Camera App</title> 
<!-- Link to your main style sheet-->
<link rel="stylesheet" href="style.css"> 
</head>
<body>
<!-- Reference to your JavaScript file -->
<script src="app.js"></script> 

<!-- Camera -->
<main id="camera">
    <!-- Camera sensor 
    <canvas id="camera--sensor"></canvas>
    <!-- Camera view 
    <video id="camera--view" autoplay playsinline></video>
    <!-- Camera output 
    <img src="//:0" alt="" id="camera--output">
    
        <!-- Camera trigger 
    <button id="camera--trigger">Take a picture</button>-->
	<div id="errlog">Error here v1.10</div>
	<div id="deviceNames">Devices:</div>
		<ul id="constraintList">List
		
	</ul>
    <video id="video" width="640" height="480" autoplay></video>
    <button id="snap">Snap Photo</button>
    <canvas id="canvas" width="640" height="480"></canvas>
   
</main>

<script>
    var video = document.getElementById('video');
    var videoConstraint = { 
		//video: true, 
		//facingMode: [{exact:"environment"}] 
		video: true,
	    	facingMode:{exact:'environment'}
	    	
	};

		let constraintList = document.getElementById("constraintList");
	let supportedConstraints = navigator.mediaDevices.getSupportedConstraints();

	for (let constraint in supportedConstraints) {
	  if (supportedConstraints.hasOwnProperty(constraint)) {
		let elem = document.createElement("li");

		elem.innerHTML = "<code>" + constraint + "</code>";
		constraintList.appendChild(elem);
	  }
	}

	// Get access to the camera!
	if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
		// Not adding `{ audio: true }` since we only want video now
		document.getElementById('errlog').innerHTML += '. Camera stream OK : ';
		navigator.mediaDevices.getUserMedia({ video: true,
	    	facingMode:{exact:'environment' }}).then(function(stream) {
			//video.src = window.URL.createObjectURL(stream);
			video.srcObject = stream;
			video.play();
		});
	}

navigator.mediaDevices.getUserMedia(videoConstraint).then(function success(stream) {
    /* do stuff */
}).catch(function(err) {
    //log to console first 
    console.log(err); /* handle the error */
    if (err.name == "NotFoundError" || err.name == "DevicesNotFoundError") {
        //required track is missing 
    } else if (err.name == "NotReadableError" || err.name == "TrackStartError") {
        //webcam or mic are already in use 
    } else if (err.name == "OverconstrainedError" || err.name == "ConstraintNotSatisfiedError") {
        //constraints can not be satisfied by avb. devices 
    } else if (err.name == "NotAllowedError" || err.name == "PermissionDeniedError") {
        //permission denied in browser 
    } else if (err.name == "TypeError" || err.name == "TypeError") {
        //empty constraints object 
    } else {
        //other errors 
    }
	document.getElementById('errlog').innerHTML += 'error was: '+err.name;
});
	
	let supports = navigator.mediaDevices.getSupportedConstraints();
if( supports['facingMode'] === true ) {
  document.getElementById('errlog').innerHTML += '. Facing Mode Supported : ';
}
	
// List cameras and microphones.

navigator.mediaDevices.enumerateDevices()
.then(function(devices) {
  devices.forEach(function(device) {
	document.getElementById('deviceNames').innerHTML += "Device Kin" + device.kind + ".     Device Label = " + device.label +
                ". Device id = " + device.deviceId;
    //console.log(device.kind + ": " + device.label +
     //           " id = " + device.deviceId);
  });
})
.catch(function(err) {
  console.log(err.name + ": " + err.message);
});

// Elements for taking the snapshot
var canvas = document.getElementById('canvas');
var context = canvas.getContext('2d');
var video = document.getElementById('video');

// Trigger photo take
document.getElementById("snap").addEventListener("click", function() {
	context.drawImage(video, 0, 0, 640, 480);
});
</script>
</body>
</html>
